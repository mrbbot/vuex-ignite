!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VuexIgnite={})}(this,function(e){"use strict";var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};const n=e=>!!(e&&e.constructor&&e.call&&e.apply),r=e=>e!==Object(e),a=e=>{switch(e){case Boolean:return!1;case Number:return 0;case Object:return null;case String:return"";case Array:return null;default:return}},s="firebase/SET",i="firebase/LIST_INIT",o="firebase/LIST_ADD",u="firebase/LIST_CHANGE",f="firebase/LIST_REMOVE",l="firebase/LIST_MOVE",c="firebase/ACTION";e.ignite=function(e){let y;e=Object.assign({state:{},mutations:{},actions:{},plugins:[]},e);let d=[];for(let t in e.firebase){const n=e.firebase[t],r=("Query"===n.constructor.name?void 0:n.ref)||n,s=r.constructor.name;if("Reference"===s||"Function"===s||"Query"===s){const s=n.type||Array;e.state[t]=a(s),d.push({name:t,ref:r,type:s})}else e.state[t]=!1,y={name:t,auth:r}}return e.mutations[i]=((e,{key:t})=>e[t]=[]),e.mutations[s]=((e,{key:t,value:n})=>e[t]=n),e.mutations[o]=((e,{key:t,value:n})=>e[t]=[...e[t],n]),e.mutations[u]=((e,{key:t,value:n})=>{const r=e[t].findIndex(e=>e[".key"]===n[".key"]);e[t]=[...e[t]],e[t].splice(r,1,n)}),e.mutations[f]=((e,{key:t,listKey:n})=>e[t]=e[t].filter(e=>e[".key"]!==n)),e.mutations[l]=((e,{key:t,listKey:n,prevListKey:r})=>{const a=e[t].findIndex(e=>e[".key"]===n),s=null!==r?e[t].findIndex(e=>e[".key"]===r):0;e[t]=[...e[t]],e[t].splice(s,0,e[t].splice(a,1)[0])}),e.actions[c]=(({commit:e},{authBinding:c,normalisedBindings:y,store:d})=>{const p=(n,a,c)=>{d.$firebaseRefs[c]=a.ref||a,n===Array?a.once("value",()=>{e(i,{key:c}),a.on("child_added",n=>{const a=n.val();e(o,{key:c,value:t({".key":n.key},r(a)?{".value":a}:a)})}),a.on("child_changed",n=>{const a=n.val();e(u,{key:c,value:t({".key":n.key},r(a)?{".value":a}:a)})}),a.on("child_removed",t=>e(f,{key:c,listKey:t.key})),a.on("child_moved",(t,n)=>e(l,{key:c,listKey:t.key,prevListKey:n}))}):a.on("value",t=>e(s,{key:c,value:t.val()}))},m=[];for(let e of y)n(e.ref)?m.push(e):p(e.type,e.ref,e.name);c&&c.auth.onAuthStateChanged(t=>{for(let n of m)if(n.currentRef&&n.currentRef.off(),d.$firebaseRefs[n.name]&&delete d.$firebaseRefs[n.name],t){const e=n.ref(t);n.currentRef=e,p(n.type,e,n.name)}else e(s,{key:n.name,value:a(n.type)});e(s,{key:c.name,value:t})})}),e.plugins.push(e=>{e.$firebaseRefs={},e.dispatch(c,{authBinding:y,normalisedBindings:d,store:e})}),e},Object.defineProperty(e,"__esModule",{value:!0})});